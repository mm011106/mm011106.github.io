<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[MQTT and ...]]></title>
  <link href="http://mm011106.github.io/atom.xml" rel="self"/>
  <link href="http://mm011106.github.io/"/>
  <updated>2014-12-13T20:31:13+09:00</updated>
  <id>http://mm011106.github.io/</id>
  <author>
    <name><![CDATA[Masakazu Miyamoto]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[やっと復活。。。]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/13/restarted/"/>
    <updated>2014-12-13T16:23:35+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/13/restarted</id>
    <content type="html"><![CDATA[<p>前のブログで「ランチャが消えちゃう」なんていう話をしていたらもっと深刻な状況に。<br/>
今度は、ランチャやメニューは表示されるのですが、デスクトップ自体が真っ黒のままで何も表示されず。ターミナルのアイコンをランチャ上でクリックすると、ターミナルは立ち上がっているようなのですが、見えません。メニューも一応見えていますが、クリックすると茶色いプルダウンらしきものが広がるだけで何も見えません。</p>

<!-- more -->


<p>ブログに書いた手順を試してみるも、ターミナルが見えないのでいかんともし難く。。。。<br/>
ブラインド状態でコマンド入力してみても、うまく入力できているようですが、効果なし。</p>

<hr />

<h2>新しいubuntuを立ち上げ</h2>

<p>webでいろいろ調べましたが、結局解決には至らず。新しいubuntuをインストールするのが早いのじゃないか、ということで再インストールに。</p>

<p>幸い、MacOSのParallelsの上の仮想PCだったので、トラブった環境はそのままにしてすすめました。こういうとき仮想環境は楽ですね。</p>

<p>まずは、大事なブログのソースファイルをまるごと救出。<br/>
Ctrl-Alt-F1でCUIベースのターミナルを開いて、</p>

<pre><code>tar czf octopress.tar.gz octopress
</code></pre>

<p>のような感じで。</p>

<p>さて、これをscpでコピーしようとしたら、どうもうまくいかず。。。</p>

<p>きちんとsshの設定をしていなかったからか。。。反省。</p>

<p>ですが、これまたラッキーなことにParallelsにはホストOSとのファイル共有が標準で用意されていて、これがubuntuでも有効です。</p>

<pre><code>cp ./octopress.tar.gz ~/Desktop/Parallels\ Shared\ Folders/
</code></pre>

<p>とするだけです。
これで大事な原稿と環境はホストOSにコピーされました。</p>

<p>肝心のインストールは、ubuntu のインストール用ディスクイメージを持ってきて、Parallelsに教えてあげるだけであとは勝手にインストールして完了。</p>

<hr />

<h2>git インストール</h2>

<p>さてここから環境の構築です。</p>

<p>まず、SSH関係をしっかりと構築したあと、</p>

<p><a href="http://octopress.org/docs/setup/">octopressのセットアップ手順</a>にしたがって、</p>

<pre><code>sudo apt-get install git
</code></pre>

<p>としてインストール。簡単。問題無し。</p>

<p>一応、動作を確認。gitで使うディレクトリに移動して</p>

<pre><code>git init
</code></pre>

<p>エラーなし。okです。</p>

<h2>ruby インストール</h2>

<p>これまた、手順にしたがって、rbenvでRubyを<a href="http://octopress.org/docs/setup/rbenv/">インストール</a>することにします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span>
</span><span class='line'>git clone git://github.com/sstephenson/rbenv.git .rbenv
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;export PATH=&quot;$HOME/.rbenv/bin:$PATH&quot;&#39;</span> &gt;&gt; ~/.bash_profile
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;eval &quot;$(rbenv init -)&quot;&#39;</span> &gt;&gt; ~/.bash_profile
</span><span class='line'>git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
</span><span class='line'><span class="nb">source</span> ~/.bash_profile
</span></code></pre></td></tr></table></div></figure>


<p>ubuntuでは、<code>.bash_profile</code>をログイン時に実行するために</p>

<pre><code>echo 'source ~/.bash_profile' &gt;&gt; .bashrc
</code></pre>

<p>としました。</p>

<p>インストールの結果を確認します。
新しいターミナルを開いて、</p>

<pre><code>echo $PATH
</code></pre>

<p>の結果に<code>~/.rbenv/bin</code>などが入って入ればいいかと思います。</p>

<p>これでrbenvツールが設定できたので、ここからRubyのインストールです。</p>

<p>私の環境では<code>zlib1g-dev</code>と<code>libssl-dev</code>が入っていなかったので、あとあとエラーしました。</p>

<p>念のため前もって</p>

<pre><code>sudo apt-get install zlib1g-dev libssl-dev
</code></pre>

<p>などとして、インストールするか確認しておいたほうがいいかもしれません。
そうでないと何回もRubyをインストールすることになります。</p>

<ul>
<li>octopressのセットアップではRubyのモジュールをダウンロードしますが、このときサーバにSSLで接続します。そのためにSSLのライブラリが必要なようです。</li>
</ul>


<p>では、インストール。解説にしたがい</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rbenv install 1.9.3-p0
</span><span class='line'><span class="nv">$ </span>rbenv <span class="nb">local </span>1.9.3-p0
</span><span class='line'><span class="nv">$ </span>rbenv rehash
</span></code></pre></td></tr></table></div></figure>


<p>と、しました。</p>

<p>実は、<code>rbenv install 1.9.3-p0</code>で<code>installなんてコマンドないよ！</code>と起こられましたが、<code>ruby-build</code>が正しい位置に持ってこれていなかったのが原因でした。</p>

<pre><code>git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
</code></pre>

<p>を正しく実行し直して事なきを得ます。</p>

<ul>
<li>webの解説によれば、<code>rbenv local ruby 1.9.3-p0</code>は、その他のディレクトリにあるRuby環境を変更することなく、octopressをインストールするために使われるそうです。もし、どこでもこのバージョンを使いたいなら、local を grobal に変更するといい、と書かれています。</li>
</ul>


<p>インストールができたら、<code>Ruby --version</code>でバージョンを確認。OK。</p>

<hr />

<h2>Octopress</h2>

<p><a href="">こちらの手順</a>にしたがってインストール。</p>

<p>まず</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone git://github.com/imathis/octopress.git octopress
</span><span class='line'><span class="nb">cd </span>octopress
</span></code></pre></td></tr></table></div></figure>


<p>としてoctopress自身を持ってきます。</p>

<p>さらに、gemで必要なRubyモジュールをインストール</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install bundler
</span><span class='line'>rbenv rehash <span class="c"># If you use rbenv, rehash to be able to run the bundle command</span>
</span><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<p>ここで、ちゃんと動くかどうか</p>

<pre><code>rake generate
</code></pre>

<p>でためしてみたところ。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rake generate
</span><span class='line'><span class="c">## Generating Site with Jekyll</span>
</span><span class='line'>identical <span class="nb">source</span>/stylesheets/screen.css
</span><span class='line'>/home/masa/.rbenv/versions/1.9.3-p0/lib/ruby/gems/1.9.1/gems/
</span><span class='line'>execjs-2.2.2/lib/execjs/runtimes.rb:51:in <span class="sb">`</span>autodetect<span class="err">&#39;</span>: Could not find
</span><span class='line'>a JavaScript runtime. See https://github.com/sstephenson/execjs <span class="k">for</span> a
</span><span class='line'>list of available runtimes. <span class="o">(</span>ExecJS::RuntimeUnavailable<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>と言われてしまいました。
&ldquo;octopress Could not find a JavaScript runtime&#8221;をキーワードに
googleさんに尋ねてみると、解決策が</p>

<pre><code>sudo apt-get install nodejs
</code></pre>

<p>を実行しろ、ということだったので、さっそくインストールし、無事<code>rake generate</code>できることを確認。</p>

<p>さらに<code>rake preview</code>で出来栄えも確認し、インストール完了。</p>

<p>やっと環境が整いました。</p>

<hr />

<h2>昔の機械から原稿を持ってくる</h2>

<p>さて、昔の機械からデータを持ってこなきゃいけませんが、オリジナルのoctopress からテーマを更新(oct2を使用)しているので、もしかしたらコピーだけではだめかもしれないという危惧もあり、厄介かなあとおもいつつも、ダメモトということで、octopressディレクトリをまるごとコピー。</p>

<p>オリジナルをキープしておいて、持ってきたものをコピーしましたが、<code>rake generate</code>では<code>「バージョンが違いますけど！」</code>と注意されてしまいます。しかたがないので、オリジナルに戻して、今度はsourceフォルダだけを昔のものに入れ替えて試してみました。</p>

<p>すると、何事もなくgenerateが可能に。さらにpreviewして元のBlogページが戻ることを確認！！ああ、素晴らしい。</p>

<p>ということで、記事を書き始めるとまたまたトラブル。。。。</p>

<p>どうも文字が大きい。さらに、バックグラウンドの絵がページの頭の部分で黒くなる。。。。</p>

<p>「うむ、やはりコピーだけではダメかああああ。」
しかたなく、もう一度octopressの環境から作り直し。さらにoct2も素直にインストールし直し。</p>

<p>まず、octopressのディレクトリをまるごと削除。もう一度インストールし直します。</p>

<p>さらにoct2を以下のようにしてインストール</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone https://github.com/bijumon/oct2.git .themes/oct2
</span><span class='line'>rake install<span class="o">[</span><span class="s2">&quot;oct2&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/bijumon/oct2">oct2のページ</a>によるインストール方法ではcloneの保存先が<code>.themes/</code>ですが、これではエラーしてしまうので、<code>.themes/oct2</code>としてみました。</p>

<p>これで一応環境は整っているはずなので、このまま何もせず</p>

<pre><code>rake preview
</code></pre>

<p>としてfirefoxなどで<a href="http://localhost:4000">localhost:4000</a>をアクセス。oct2が有効になっていることを確認します。</p>

<p>いよいよblogのソースをコピーします。といっても、.mdの原稿を<code>_post</code>ディレクトリにコピーするだけです。</p>

<p>さらに、以下のファイルをコピーしました。</p>

<pre><code>./_config.yml
./public/image/background.png  (自分で作ったバックグラウンドカラー）
./public/image/logo.png
./public/image/(その他必要な画像）
./source/includes/post/date.html（日付表示がうまくいくように変更したもの）
./source/(その他、自分で作ったディレクトリ）
</code></pre>

<p>これで、再び<code>rake preview</code>を実行。</p>

<p>！！！やっとこれで元通り！！！とおもったところが、まだ文字が異常に大きい。。。</p>

<p>これまた、googleにたずねると、「<a href="http://blog.nambo.jp/2013/07/26/change-octopress-font-size/">ここをご覧なさい</a>」といわれたので、そのまま追加して、納得できる出来栄えに。。。。</p>

<figure class='code'><figcaption><span>./sass/custom/_stypes.scss　に追加</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">h1</span> <span class="p">{</span> <span class="k">font-size</span><span class="o">:</span> <span class="m">1.2em</span><span class="p">;}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">h2</span> <span class="p">{</span> <span class="k">font-size</span><span class="o">:</span> <span class="m">1.1em</span><span class="p">;}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">h3</span> <span class="p">{</span> <span class="k">font-size</span><span class="o">:</span> <span class="m">1.0em</span><span class="p">;}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">#content</span> <span class="nc">.blog-index</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">article</span> <span class="n">h1</span> <span class="err">{</span>
</span><span class='line'>    <span class="k">font-size</span><span class="o">:</span> <span class="m">1.2em</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これもちょっと腑に落ちない妙な動作をするのですが、まあ、とりあえず吉としておきます。とおもいましたが、やはり気になるので<a href="http://yuyunko.github.io/blog/2013/03/04/octopress-%E3%83%86%E3%83%BC%E3%83%9E%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%B9%E3%82%99/">他の方法</a>も試してみるとこちらの方がいい感じなので、こうしました。</p>

<figure class='code'><figcaption><span>./sass/custom/_styles.scss　を変更</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">body</span> <span class="p">{</span> <span class="k">font-size</span><span class="o">:</span> <span class="m">0.8em</span><span class="p">;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>お疲れさまでした。
ほぼ1日消費です。</p>

<p>そうそう、Parallelsでスナップショットをとっておこう。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ubuntuのランチャとかが消えてしまう件]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/07/ubuntu-problem/"/>
    <updated>2014-12-07T13:19:44+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/07/ubuntu-problem</id>
    <content type="html"><![CDATA[<p>apt-get upgradeとかコマンドラインから実行するとubuntuのランチャなどが消えてしまうという状態に時々なります。ランチャだけならいいのですが、メニューが表示されるところまで消えてしまうし、文字入力もできなくなります（つまり、見えはするけど手が出せない状態）</p>

<!-- more -->


<p>検索してみたところ、<a href="http://m12i.hatenablog.com/entry/2014/05/24/100539">この</a>ページにあるような症状にぴったりだったので、書かれている復活手順を踏んでみました。以下はその引用です。　<strong>　<em>mizukyfさん、ありがとうございます。</em> </strong></p>

<ul>
<li><p>ログイン後 Ctrl＋Alt＋F1キー入力 でコンソール画面に遷移。</p></li>
<li><p>「（マシン名） login:_」という表示されるのでログイン。</p></li>
<li><p>「DISPLAY=:0.0 gnome-terminal」と入力しEnter。gnomeの上のターミナルを起動</p></li>
<li><p>Alt＋F7キーを押下するとデスクトップ画面に復帰するが端末ウィンドウが新たに表示されている。</p></li>
<li><p>このターミナル上で「dconf reset -f /org/compiz/」と入力してEnter。</p></li>
<li><p>「sudo shutdown -r now」と入力してEnter。OSが再起動する。</p></li>
</ul>


<p>多分、<code>dconf reset -f /org/compiz/</code>が重要なので、コンソールでログインしたあとにこれを実行すればいい、という気もします。
今度不具合になったら試してみましょう。</p>

<p>PS:<br/>
<a href="http://ja.wikipedia.org/wiki/Compiz">compiz</a>を調べてみたところ、ウインドーマネージャなのですねえ。<br/>
<a href="http://en.wikipedia.org/wiki/Dconf">dconf</a>はいろいろな設定を一気に引き受けるユーティリティ。あるwebの解説によれば「Windowsのレジストリシステムのようなもの」とのこと。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[max_queued_messagesオプションの動作]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/07/max-quieued-messages/"/>
    <updated>2014-12-07T10:14:05+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/07/max-quieued-messages</id>
    <content type="html"><![CDATA[<p>ということで、先の<code>max_queued_messages</code>オプションを試してみました。</p>

<p>結論から言うと、バッファリングしているのは<strong>指定した数の最も古いデータ</strong>でした。</p>

<!-- more -->


<p>確認手順：</p>

<ul>
<li><p>mosquitto.confに<code>max_queued_messages 30</code>と設定<br/>
これで、30個のデータが保持されるはず。</p></li>
<li><p>ブローカが動いている計算機から <code>$ sudo /etc/init.d/mosquitto restart</code>　で設定を反映</p></li>
<li><p>QoS１、clear_sessionをfalseでブローカにサブスクライブ要求します。</p></li>
<li><p>適当に中断</p></li>
<li><p>適当に再開<br/>
今回は寝る前に止めて朝起きて再接続してみました。<br/>
あとでデータを確認できるよう<code>reconnect.txt</code>というファイルに保存。データの第一フィールドは送信時のタイムスタンプになっています。</p></li>
</ul>


<p>で、送られたデータを確認してみると。。。。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>cat reconnect.txt <span class="p">|</span> awk -F , <span class="s1">&#39;{ command = &quot;date -d @&quot; $1 ; printf NR&quot;   &quot; ; system(command) }&#39;</span>
</span><span class='line'><span class="m">1</span>   Sat Dec  <span class="m">6</span> 21:33:01 JST 2014
</span><span class='line'><span class="m">2</span>   Sat Dec  <span class="m">6</span> 21:34:02 JST 2014
</span><span class='line'><span class="m">3</span>   Sat Dec  <span class="m">6</span> 21:35:01 JST 2014
</span><span class='line'>  <span class="o">(</span>...snip..<span class="o">)</span>
</span><span class='line'><span class="m">27</span>   Sat Dec  <span class="m">6</span> 21:59:01 JST 2014
</span><span class='line'><span class="m">28</span>   Sat Dec  <span class="m">6</span> 22:00:01 JST 2014
</span><span class='line'><span class="m">29</span>   Sat Dec  <span class="m">6</span> 22:01:01 JST 2014
</span><span class='line'><span class="m">30</span>   Sat Dec  <span class="m">6</span> 22:02:02 JST <span class="m">2014</span> &lt;指定した数だけ古いデータがあって
</span><span class='line'><span class="m">31</span>   Sun Dec  <span class="m">7</span> 09:57:01 JST <span class="m">2014</span> &lt;そのあと最新の配信データが届く
</span><span class='line'><span class="m">32</span>   Sun Dec  <span class="m">7</span> 09:58:02 JST 2014
</span></code></pre></td></tr></table></div></figure>


<p>ということで、停止してすぐのデータが指定数だけ保存されている、という結論です。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mosquitto.conf 再び]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/06/again/"/>
    <updated>2014-12-06T19:58:41+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/06/again</id>
    <content type="html"><![CDATA[<p>昨日の、通信が途絶えている時にブローカがためておいてくれる件、<code>mosquitto.conf</code>にはこんなオプションがありました。</p>

<ul>
<li><strong>max_queued_messages</strong></li>
</ul>


<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># The maximum number of QoS 1 and 2 messages to hold in a queue </span>
</span><span class='line'><span class="c"># above those that are currently in-flight.  Defaults to 100. Set </span>
</span><span class='line'><span class="c"># to 0 for no maximum (not recommended).</span>
</span><span class='line'><span class="c"># See also queue_qos0_messages.</span>
</span><span class='line'><span class="c">#max_queued_messages 100</span>
</span></code></pre></td></tr></table></div></figure>


<p>データ送信のキューに長さの最大を指定します。これ以上になったらどうなるのかなあ？古いやつから捨てられるのかしら？</p>

<p>さらに max_inflight_messagesというのもあって、こちらは通信中(?)の最大メッセージ数を規定します。</p>

<p>client IDの件に関連するオプションでこんなものもありました。</p>

<ul>
<li><strong> allow_zero_length_clientid </strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># This option controls whether a client is allowed to connect with a zero</span>
</span><span class='line'><span class="c"># length client id or not. This option only affects clients using MQTT v3.1.1</span>
</span><span class='line'><span class="c"># and later. If set to false, clients connecting with a zero length client id</span>
</span><span class='line'><span class="c"># are disconnected. If set to true, clients will be allocated a client id by</span>
</span><span class='line'><span class="c"># the broker. This means it is only useful for clients with clean session set</span>
</span><span class='line'><span class="c"># to true.</span>
</span><span class='line'><span class="c">#allow_zero_length_clientid true</span>
</span></code></pre></td></tr></table></div></figure>


<p>client IDなしで接続できるかどうか、を設定するオプションかと思われます。ここに書いてあるようにIDを設定してしまうと、サブスクライブ接続を切った時に、それがテンポラリーなのかパーマネントなのかブローカは知る由がありません。そのため、同じIDで再接続されると切断されていた期間のデータが送られてきます。それは不要、という時もありますよね。。。。</p>

<p>今のところの対処は、一度 QoS0で再接続してから切る、というのをやっています。こうすると次に接続した時は接続後の情報から入手できます。ほんとはもっといい手があるのかとも思いますが。</p>

<p>ココらへんは、データアクイジションの側であれば、あとから不要な部分を切り取るとか、いかようにでも処理できるかと思います。コマンド系の接続では重要なポイントになりそうなので、考慮の必要がありそうですね。タイムスタンプを確認するとか。</p>

<p>などと話していたら、こんなオプションがありました。</p>

<ul>
<li><strong>persistent_client_expiration</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># This option allows persistent clients (those with clean session set to false)</span>
</span><span class='line'><span class="c"># to be removed if they do not reconnect within a certain time frame.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># This is a non-standard option in MQTT V3.1 but allowed in MQTT v3.1.1.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Badly designed clients may set clean session to false whilst using a randomly</span>
</span><span class='line'><span class="c"># generated client id. This leads to persistent clients that will never</span>
</span><span class='line'><span class="c"># reconnect. This option allows these clients to be removed.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># The expiration period should be an integer followed by one of d w m y for</span>
</span><span class='line'><span class="c"># day, week, month and year respectively. For example</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># persistent_client_expiration 2m</span>
</span><span class='line'><span class="c"># persistent_client_expiration 14d</span>
</span><span class='line'><span class="c"># persistent_client_expiration 1y</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># The default if not set is to never expire persistent clients.</span>
</span><span class='line'><span class="c">#persistent_client_expiration</span>
</span></code></pre></td></tr></table></div></figure>


<p>persistentは「しつこい」という意味らしいですが、長い接続は強制的に解除するということのようです。
「ランダムのidを使っていながらclean session（切断時の送信データを破棄してもらうモード）をfalseで接続してくるたちの悪いクライアント」とありますね。そういう接続はしないように設計します。はい。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[disable-clean-sessionオプション]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/05/mosquitto-sub-c-option/"/>
    <updated>2014-12-05T21:14:40+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/05/mosquitto-sub-c-option</id>
    <content type="html"><![CDATA[<p>一昨日から気になっていた<a href="http://mosquitto.org/man/mosquitto_sub-1.html"><code>mosquitto_sub --disable-clean-session</code></a>オプションですが、試してみました。</p>

<p>ブローカに向かって<code>--desiable-clean-session</code>と<code>--id</code>の2つのオプションをつけてサブスクライブを要求します。</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mosquitto_sub -h HOSTNAME -t YOUR/TOPIC/NAME --qos <span class="m">1</span> --disable-clean-session --id CONNECTION-ID
</span><span class='line'>
</span><span class='line'>1417781342, 1691, 0, 0, 0
</span><span class='line'>1417781402, 1691, 0, 0, 0
</span><span class='line'>1417781461, 1691, 0, 0, 0
</span><span class='line'>1417781522, 1691, 0, 0, 0　　&lt;&lt;時刻 21:12:02　で中断
</span><span class='line'>^C
</span></code></pre></td></tr></table></div></figure>


<p><code>--id</code>オプションはサブスクライバが同一であることを主張するためのもののようですので、これが一致することで「再接続だから配信していないデータを送らなきゃ」と認識してくれます。<code>--id</code>を指定しないとデフォルトのプロセス番号を元にしたものになるので、プロセスを止めて再度起動した場合「再接続」と認識してもらえません。
また、&ndash;qosが1もしくは2でないとダメみたいです。QoS　0は配信保証がなされないクオリティ指定ですので、当然といえば当然。</p>

<p>データが来たところで、適当に中断します。このトピックではパブリッシャが1分毎に1データを送ってきます。データの最初のフィールドがエポックタイムです。よく見ると60づつ増えていっているのがわかります。</p>

<p>そしてCtrl-Cでプロセスを止めます。</p>

<p>では、ここでしばらく待って。。。。。</p>

<p>わかりやすいように、タイムスタンプを印刷してからサブスクライブを再開します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>date <span class="p">;</span> mosquitto_sub -h __host-name__ -t YOUR/TOPIC/NAME --qos <span class="m">1</span> --disable-clean-session --id  testclient
</span><span class='line'>
</span><span class='line'>Fri Dec  <span class="m">5</span> 21:24:54 JST 2014
</span><span class='line'>1417781581, 1692, 0, 0, 0　　&lt;&lt;　再開したのは21:24:54だけど、21:13:01のデータから配信されている。
</span><span class='line'>1417781642, 1691, 0, 0, 0
</span><span class='line'>1417781701, 1691, 0, 0, 0
</span><span class='line'>1417781761, 1692, 0, 0, 0
</span><span class='line'>1417781822, 1691, 0, 0, 0
</span><span class='line'>1417781881, 1691, 0, 0, 0
</span><span class='line'>1417781942, 1692, 0, 0, 0
</span><span class='line'>1417782002, 1692, 0, 0, 0
</span><span class='line'>1417782061, 1692, 0, 0, 0
</span><span class='line'>1417782121, 1692, 0, 0, 0
</span><span class='line'>1417782182, 1692, 0, 0, 0
</span><span class='line'>1417782241, 1692, 0, 0, 0
</span><span class='line'>1417782302, 1692, 0, 0, 0
</span><span class='line'>1417782361, 1692, 0, 0, 0
</span><span class='line'>   ：
</span><span class='line'>   :
</span></code></pre></td></tr></table></div></figure>


<p>おお、きちんと中断している間のデータも配信されました。</p>

<p><code>--id</code>オプションには次のように書かれています。</p>

<p><strong> -i, - -id </strong></p>

<blockquote><p>The id to use for this client. If not given, defaults to mosquitto_sub_ appended with
the process id of the client. Cannot be used at the same time as the <strong> <em>&ndash;id-prefix</em> </strong> argument.</p></blockquote>

<p>通常、IDは<code>mosquitto_sub_${PID}</code>になるようです。でもpidは起動するたびに変わってしまうので、同じクライアントとは認識されませんね。物理経路のトラブル等で通信が途絶えた場合は大丈夫でしょうけれど。</p>

<p><code>--id-prefix</code>はプリフィックスを固定してしまうオプションなので、<code>--id</code>とは共存できないということですね。</p>

<p>関連するところで<br/>
ブローカの方の設定で<code>clientid_prefixe</code>というのがあるのですが、これを設定（mosquitto.conf内）すると、指定したプリフィックスのついたクライアントしか接続出来ないようにできるようです。</p>

<p><strong>clientid_prefixes</strong> <em>prefix</em></p>

<blockquote><p>If defined, only clients that have a clientid with a prefix that matches clientid_prefixes will be
allowed to connect to the broker. For example, setting <em>&ldquo;secure-&rdquo;</em> here would mean a client
&ldquo;<em>secure-</em>client&rdquo; could connect but another with clientid &ldquo;mqtt&rdquo; couldn&rsquo;t. By default,
all client ids are valid.</p></blockquote>

<p>となるようです。セキュリティの一助になるかしら？</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mosquitto.confを見てみた]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/04/mosquitto-dot-conf/"/>
    <updated>2014-12-04T20:21:14+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/04/mosquitto-dot-conf</id>
    <content type="html"><![CDATA[<p>やっぱりmanは見ないとダメ、ということで、まずは<code>mosquitto.conf</code>を紐解いています。
原文はこちら<a href="http://mosquitto.org/man/mosquitto-conf-5.html"><code>man mosquitto.conf(5)</code></a></p>

<p>つらつらとながめていると、昨日疑問に思っていた部分が書かれていました。</p>

<!-- more -->


<p><strong>mount_point</strong>  <em>topic prefix</em></p>

<blockquote><p>This option is used with the listener option to isolate groups of clients.
When a client connects to a listener which uses this option, the string argument is attached to the start of all topics for this client. This prefix is removed when any messages are sent to the client. This means a client connected to a listener with mount point <em><strong>example</strong></em> can only see messages that are published in the topic hierarchy <em><strong>example</strong></em> and above.</p></blockquote>

<p>さらに、<code>mosquitto.conf</code>のデフォルトでは、この部分が</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># The listener can be restricted to operating within a topic hierarchy using
</span><span class='line'># the mount_point option. This is achieved be prefixing the mount_point string
</span><span class='line'># to all topics for any clients connected to this listener. This prefixing only
</span><span class='line'># happens internally to the broker; the client will not see the prefix.
</span><span class='line'>#mount_point</span></code></pre></td></tr></table></div></figure>


<p>となっています。</p>

<p>「クライアント」と「リスナー」という言葉が出てきて？？？な感じです。。。。</p>

<blockquote><p>The network ports that mosquitto listens on can be controlled using listeners.</p></blockquote>

<p>とあるので、ブローカーがパブリッシャからの聞き耳を立てるポートをコントロールするためのものが「リスナー」なんでしょうか。どうも、そうみたいですね。
「リスナー」は、MQTTのプロトコルを通信するためのポートに、この設定ファイルで設定できるようなメソッドを組み込んだオブジェクトみたいな感じでしょうか。</p>

<p>その「リスナー」の部分、<code>mosquitto.conf</code>では</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Listen on a port/ip address combination. By using this variable 
</span><span class='line'># multiple times, mosquitto can listen on more than one port. If 
</span><span class='line'># this variable is used and neither bind_address nor port given, 
</span><span class='line'># then the default listener will not be started.
</span><span class='line'># The port number to listen on must be given. Optionally, an ip 
</span><span class='line'># address or host name may be supplied as a second argument. In 
</span><span class='line'># this case, mosquitto will attempt to bind the listener to that 
</span><span class='line'># address and so restrict access to the associated network and 
</span><span class='line'># interface. By default, mosquitto will listen on all interfaces.
</span><span class='line'># listener port-number [ip address/host name]
</span><span class='line'>#listener</span></code></pre></td></tr></table></div></figure>


<p>となっているので、ポートを「リスナー」として設定して開けば、その一つ一つに個別のマウントポイントを設定できる、という感じですかね。でもサブスクライバの方はどうなるんでしょ？サブスクライブできるトピックを限定できるのかなあ。そうか、ポート毎（リスナー毎）にマウントポイントを設定できればそのポート（リスナー）のサブスクライバは全部そのマウントポイントしか見えない、ってことか。パブリッシャも同様。
listenerごとにipアドレスやホストネームをバインドできるのはそのためですかね。とすれば、IPアドレスは複数設定できなきゃいけませんね。。。。</p>

<p>その他セキュリティ設定のところでも、特定のトピックの読み書きが可能なように設定できたりするようです。</p>

<p>そもそも「クライアント」はサブスクライバとパブリッシャの両方のことを意味するのかしら？？？</p>

<p>奥深し。。。。。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[mosquitto_subのオプション]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/03/mqtt-option/"/>
    <updated>2014-12-03T20:43:00+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/03/mqtt-option</id>
    <content type="html"><![CDATA[<p>今日も何気なく検索しながら、webを眺めていたら、<code>mosquitto_sub</code>のこんなオプションを発見。</p>

<p><strong><code>-c, --disable-clean-session</code></strong></p>

<!-- more -->


<p></p>

<p><code>Disable the 'clean session' flag. This means that all of the subscriptions for the client will be maintained after it disconnects, along with subsequent QoS 1 and QoS 2 messages that arrive. When the client reconnects, it will receive all of the queued messages.</code>
<code>If using this option, it is recommended that the client id is set manually with --id</code></p>

<p>これがちゃんと動けば、結構いいですよねえ。でもまあ、ちゃんと<code>man</code>読めよ、って話ですな。</p>

<p>週末に試してみよう。</p>

<p>ところで全く話は違いますが、<code>mosquitto(8)</code>では1つのブローカのプロセスで1つのトピックツリーを持っているのですよね。
もし、1つのブローカを多くのユーザが共有した場合、お互いのトピックツリーは自由に行き出来できてしまいますよねえ。多くのユーザで使いたいときはどうすればいいのかなあ、と思っていた次第。
<code>-iオプション</code>でユーザ名を指定すればユーザ名ごとにトピックツリーを作ってくれるのかしら？</p>

<p>これも試す必要があります。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress+OCT2のちょっとした修正]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/02/minor-adjustment/"/>
    <updated>2014-12-02T20:28:23+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/02/minor-adjustment</id>
    <content type="html"><![CDATA[<p>今まで、ブログのポスト日時表示がうまく行かなかったので色々と調べまわっていました。しかし、web上ではなかなか情報がなく、半分諦めていました。ふと、昔はどうだったかなあ、と気になってoctopressをインストールしたばかりの時に試しに使っていたテーマで生成したHTMLコードを見てみたところ、ブログページに日付が入っていることを発見。なら、この部分だけ持ってきて入れなおしてみるかな、とやってみたところうまく行きました！</p>

<!-- more -->


<p>このページはOCT2というテーマを使っているのですが、そのソース<code>source/_include/date.html</code>では日付が代入されている（と思われる）変数が<code>post.date_formatted</code>となっているのですが、これではうまく表示できないようです。ポスト日時が表示できていた昔のソースではここが<code>post.date</code>になっていました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{% capture date %}{{ page.date }}{{ post.date }}{% endcapture %}
</span><span class='line'>{% capture date_text %}{{ page.date_text }}{{ post.date_text }}{% endcapture %}
</span><span class='line'>{% capture has_date %}{{ date | size }}{% endcapture %}
</span><span class='line'>
</span><span class='line'>{% capture updated %}{{ page.updated }}{{ post.updated }}{% endcapture %}
</span><span class='line'>{% capture updated_text %}{{ page.updated_text }}{{ post.updated_text }}{% endcapture %}
</span><span class='line'>{% capture was_updated %}{{ updated | size }}{% endcapture %}
</span><span class='line'>
</span><span class='line'>{% if has_date != '0' %}
</span><span class='line'>  {% capture time %}&lt;time datetime="{{ date | datetime | date_to_xmlschema }}" pubdate{% if updated %} data-updated="true"{% endif %}>{{ date_text }}&lt;/time>{% endcapture %}
</span><span class='line'>{% endif %}
</span><span class='line'>
</span><span class='line'>{% if was_updated != '0' %}
</span><span class='line'>  {% capture updated %}&lt;time datetime="{{ updated | datetime | date_to_xmlschema }}" class="updated">Updated {{ updated_text }}&lt;/time>{% endcapture %}
</span><span class='line'>{% else %}{% assign updated = false %}{% endif %}</span></code></pre></td></tr></table></div></figure>


<p>中身がわからないまま使っているので、この変数がどこでどのように定義されているのかいまいちわかっていませんが、<code>post.date_formatted</code>にはうまく値が入っていないようです。あるいは、<code>formatted</code>にするために何か他のモジュールのようなものがいるのかもしれません。<br/>
やったことは、もともとある<code>octopress/_include/date.html</code>のファイル名を変更してオリジナルを保存。次に、うまく時間表示ができていた以前のテーマの同じテンプレートをコピー。それだけ。</p>

<p>あまり深く詮索せず、とりえあず表示できたので良しとします。日付のフォーマットも西洋風ですが、まああまり違和感ないのでこのまま。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[試作システムの概要]]></title>
    <link href="http://mm011106.github.io/blog/2014/12/01/overview/"/>
    <updated>2014-12-01T20:20:23+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/12/01/overview</id>
    <content type="html"><![CDATA[<h3>概略の仕様</h3>

<p>試作しようとしているシステムの概要は以下のような感じです。</p>

<!-- more -->


<p><strong>用意するもの</strong></p>

<ul>
<li>Edge device:　センシング用マイコン+ネットワーク接続</li>
<li>MQTT ブローカ：　通信プロトコルはMQTTを使いますので、ブローカが必要です。</li>
<li>Core device: linux 計算機</li>
</ul>


<p><strong>動作</strong></p>

<ul>
<li>センサで状態を数値化（現状、温度とアナログ計測装置のモニタ電圧（直流）を想定）</li>
<li>規定の時間毎（1分〜1時間ぐらい）に送信</li>
<li>Core Deviceでデータを保持</li>
<li>規定の時間毎（数時間）に経時変化をグラフ化し指定されたユーザにメールで返信</li>
</ul>


<p><strong>その他</strong></p>

<ul>
<li>現状ではEdge deviceのコントロールは考えていません。</li>
<li>接続はSSHを使ったポートフォワーディング</li>
<li>Edge device、　MQTTブローカにはRaspberry Piを使用</li>
</ul>


<p><strong>Edgeデバイスのこと</strong></p>

<p>Raspberry Piはアナログ入力ポート（ADコンバータ）が少ないので増設します。<br/>
OSがSDカードに乗っているのでSDカードの寿命がどれぐらいか気になるところですが、今回の試作で実際のSDカードへのアクセス量の実績が出れば、それで寿命が想定できると思います。工業用のSDカードはめちゃくちゃ高いので、きちんと設計してから必要な容量を購入したいです。一応目標としては、最低でも5年ぐらいは連続動作するようなものがほしいですね。<br/>
将来的には、mbedに移行したいと思っています。RaspberryPiは値段は十分に安いですが、ちょっとオーバースペック的なところがあり、ミニマムにした時にどこまで削ぎ落とせるかという点では、mbedぐらいの規模がコストやメンテナンス、応用範囲を考えるとベストなサイズじゃないかという感じがします。特に、OSがリリースされれば開発しやすさも変わるかな、とちょっと期待しています。</p>

<p><strong>プロトコルのこと</strong></p>

<p>2年ほど前、このシステムのフィジビリティテストみたいなことで最初のシステムをプロトタイピングしたのですが、その時には<a href="http://mqtt.org/">MQTT</a>のことを知らずに、メールでデータを送るシステムをつくりました。httpでも良かったのかもしれませんが、プッシュでデータを送るとなるとちょっと面倒かなあ、と思ったのとApachサーバを立てることになり、ちょっと面倒だ（というかこれでくじけるかも）と感じたので、gmailのアカウントを作ってEdge deviceはそこに対してメールすればそれでおしまい、というような構成にしました。<br/>
Edge device のプログラミングで使ったpythonは、幸いなことにモジュールがすごく良く完備されていて、データを読み込んでメールするまでの処理がほんの60行程度のコードで収まってしまいました。初めてのpythonでしたが、1日程度でざっくり動くものができ、2〜3日でだいたい完成しました。<br/>
ただ、リアルタイム性を求めないような用途、たとえば1時間に1回程度のサンプリングならこれでも十分ですが、たとえば1分に1回とか、10秒に1回となるとメールでいちいち送ってはいられません。まとめて1000個分のデータを送るとか言うような、バッチ処理的アプローチも考えましたが、あまり面白くないなあとおもいつつ、フィジビリティテストのプロトタイピングは終わりました。<br/>
そしてつい最近、MQTTというプロトコルの存在を知り、「ああ、これだ！」という直感で飛びつきました。</p>

<p><strong>Coreデバイスのこと</strong></p>

<p>コアデバイスという呼び方でいいのかどうかわかりませんが、データを集計する側のセットアップです。<br/>
こちらは定番でubuntuを使うことにします。昔々はFreeBSDを使っていたのですが、しばらくunix系OSから離れているうちにlinuxがすごく使いやすくなっていたのでそちらに転向しました。<br/>
この上で使うのはシェルとgnuplot程度です。（それと、ps2pdf）</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ET2014コンファレンス　レポート]]></title>
    <link href="http://mm011106.github.io/blog/2014/11/30/et2014-report/"/>
    <updated>2014-11-30T10:18:25+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/11/30/et2014-report</id>
    <content type="html"><![CDATA[<p>２週間ほど前に開かれたEmbedded Technology の展示会（パシフィコ横浜）に行って来ました。「流行り」のIoTの情報とその流行り具合を体感しにいってきました。  やはりこればかりはnet上ではなかなか難しいです。</p>

<p>カンファレンス主体で参加しましたので、その内容をメモしておきます。</p>

<!-- more -->


<h2>2014/11/19</h2>

<ol>
<li><p>　10:00〜11:00　　<strong>【IoT基調講演】IoTによる新ビジネスの可能性</strong>　　武居 輝好 氏　株式会社野村総合研究所</p>

<p> <strong>1.　IOTとは?</strong><br/>
 物がネットに繋がることで価値あるサービスを生み出す。 M2Mとは違い、人がコントロール、人が情報を使う。<br/>
 なぜ今なのか？　->  環境の進化　デバイス、回線、価格、ファンダメンタルの全て</p>

<p> 　　<strong>実例：</strong><br/>
 　　Microsoft　Azureによる対応<br/>
 　　ARMの対応　OSの準備、クラウドの準備</p>

<p> 　　<strong>標準化</strong><br/>
 　団体による　IETF, 3GPP, ITU, ETSI,oneM2M</p>

<p> 　業界による　open interconnect, allseen alliance, industrial internet consortiam, ThreadGroup</p>

<p> <strong>2.　先行ユーザ例</strong><br/>
 M2MからIOTへ<br/>
 M2Mは機器の制御、安全、保守のものだっが、機器から得られるデータを社会に還元すると言う形でIOTへ</p>

<p> 　　<strong>何が出来るか？</strong></p>

<ul>
<li>付加価値の向上</li>
<li>機能の向上、使い方のアドバイス、状況の可視化</li>
<li>アフターサービスの充実</li>
<li>リモートコントロール、故障の予兆を発見</li>
<li>オペレーションの改善</li>
<li>動作状況の記録を元にオペレーションの最適化、自動コントロール</li>
</ul>


<p> 　<strong>事例：</strong></p>

<p> 　<strong>計測機器</strong>
  データを直接サーバに送り、専門家に分析させ、即現場にフィードバック<br/>
 今までは：作業者の中に（現場に）計測のプロフェッショナルが必要だった<br/>
 これから：現場は作業に集中することが出来る、リアルタイムでの分析結果のフィードバック、同様の事例とのマッチングなど付加価値</p>

<p> 　<strong>ロストバゲッジの改善</strong>
 　単なるRFIDではなく、搭乗航空機、最終目的地、持ち主、日程、などの複合的な要素との関連づけによりロストバゲッジを改善する</p>

<p> 　<strong>テスラ自動車</strong>
 　ソフトウエアアップデートの改善</p>

<p> 　<strong>ブリジストン</strong>
 　タイヤのセンシングにより、鉱山用車両の最適管理　ドライバへのフィードバック、工場管理へのデータフィードバック、故障率寿命の予測によるメンテナンスの効率化など。</p>

<p> 　<strong>スターバックス</strong>
 　コーヒーメーカのインテリジェント化　各店での利用の傾向、機器管理、豆のパラメタのフィードバックおよびレシピの最適化</p>

<p> 　<strong>事例まとめ：</strong><br/>
 　　実用的面での問題点を解決する手段。リアルタイムの状況把握を現場からリモートで。</p>

<p> <strong>3.　課題</strong></p>

<ul>
<li>リアルタイムのデータ取得・処理の方法</li>
<li>端末のセキュリティ</li>
</ul>


<p> &ndash; セキュリティ：　回線・データのセキュリティ　と　得られるデータのセキュリティ<br/>
 　　クラッキングへの対応、ウイルスへの対応<br/>
 　　PCのようにリソースリッチ出ない状況の中でどのように対処するか？課題</p>

<p> &ndash; リアルタイムデータ：　多量の端末による帯域の問題<br/>
 　　数万ノードがいっぺんに通信したらどうなるか。<br/>
 　　　　　　　↓<br/>
 処理の遅延、処理のコスト、トラフィック、プロセスパワー<br/>
 これを解決するために、端末、ゲートウエイへの処理の移譲</p>

<p> 端末の状態管理、データの一次処理などをデバイス側で行う
 Big Dataの活用に支障が出ないように（つまり処理しすぎない）</p>

<p> <strong>4.　IOTビジネス拡大に向けて</strong></p>

<p> 　ベクトル１：　自社製品のデータを活用する<br/>
 　　　データの高密度かによる蓄積データの活用</p>

<p> 　ベクトル2:　自社製品と他社製品のネットワーク<br/>
 　　　リアルタイムで他社とのネットワークに繋がる、社会と繋がることによる新しいサービスの提供</p>

<p> これら両方を合わせて新しいビジネスモデルの構築<br/>
 　　　　　　↓<br/>
 リアルタイムな多機器との連携</p>

<ul>
<li>既存サービスとの連携でそのサービスの品質を向上する、今まで無理と思われていたサービスが可能になる。</li>
<li>「デバイスメーカから見たときの異業種」であると、より有効なサービスが生まれる可能性がある。</li>
<li>メーカがAPIを公開することにより、まったく知らない人たちがデータを活用、あるいは全く違う分野のデータと結合させあたらなサービスが生まれる可能性。　->　<strong>新しいエコシステムへ</strong></li>
</ul>


<p> <strong>感想</strong>
 IoTの目的や目指すところの全体像が見えた、重要なプレゼンだったように思います。特に、坂村さんの提唱するように「すべてをAPIでオープンにする」というところと重なっているように思います。APIはデバイス側の受け口ですが、IoTというとどちらかといえば情報の取り出し口のようなニュアンスがあります。実際にはその両方がIoTには込められていると思い直しています。
 問題点として、処理負荷とセキュリティを挙げています。私はエッジ側での処理はできるだけしないほうがいい、とおもっているので、処理負荷については興味があるところです。しかしGPGPUの発展などを見ていくと、そんなに大コストでなく、十分な処理ができるようにも思います。リアルなもののサンプリングは色付けなしで細かくしておいたほうが後々役立ちます。
 一方セキュリティは大きな問題ですが、センシング側のノードが増えると同じものを違う角度でサンプリングしているという状況が多く出てくるはずです。そのコヒーレンシ的な情報をうまく活用すれば、クラッキングなどに強いシステムができるような気がしています（素人目線ですが）。　お互いのコネクションが有機的になりニューラルネットワークのようになれば自律的になり得るかなあ。そうすれば1個や2個クラックされても大勢に影響が無いようにできるはず。</p></li>
<li><p>　11:15〜12:00　　<strong>IoT時代を牽引するセンサ・ソリューション</strong>　　野口 洋 氏　STマイクロエレクトロニクス株式会社</p>

<p> センサ、プロセッサ、通信と、IoTで必要なものは全てありますよ、的な内容。あまりSTの半導体は使ったことないのだけれど、MEMS関係はこれからお世話になるかもしれません。</p></li>
<li><p>　13:30〜14:30　　<strong>【IoT基調講演】ウェアラブルコンピューティングのための組込み技術とソリューション</strong>　　塚本 昌彦 氏　神戸大学大学院</p>

<p> 特に記載することはないです。タイトルとはだいぶかけ離れた内容で、話題もnet上の話題を超えてはいません。</p></li>
<li><p>　14:45〜15:30　　<strong>組込みシステムをクラウドに接続する際の課題</strong>  ダグラス・アンダーソン 氏　Microchip Technology Incorporated</p>

<ul>
<li>IoTでは、デバイスからITまでの広い範囲をインテグレートする必要がある。それは一人の技術者で出来る話では無い。</li>
<li>IOTを束ねるゲートウエイを導入するのが効率が良い。</li>
<li>IOTが必要とされるところはインフラが少ない場合がある、無線でゲートウエイまでデータを飛ばしてそこから優先や3Gを使ってネットに。</li>
<li>ITの側ではパートナーと仕事を進めるべき。組み込み技術者が思っているほどITは簡単では無い。</li>
<li>Amazon web serviceと提携したWCM開発キット　基板上のスイッチのモニタ、LEDのドライブをwebからできる。</li>
</ul>


<p> <strong>感想：</strong><br/>
 まずは全部自分で組み立ててみる、というのがアマチュア精神。規模が小さければ全部自前でもokとおもう。ITのプロが逆にIoTのことがわかるかというと、そうでもないはず。ならばそこに新しいビジネスがあるかも。</p></li>
</ol>


<h2>2014/11/20</h2>

<ol>
<li><p>　10:00〜11:00　　<strong>【IoT基調講演】ClouT: IoTとクラウドの融合によるスマートシティの構築</strong>　　徳田 英幸 氏　慶應義塾大学</p>

<p> 街レベルのIoTが生活をサポートする<br/>
 clouT：IoTのためのクラウドの融合</p>

<p> ICTの進化によるSocial Open Big Dateの活用。それをサポートするIoTによる情報収集。<br/>
 IoTのドライブフォース：　繋がるメリット、コスト、ネットワークの利便性</p>

<p> メリットとリスクが発展のキーを握っている</p>

<p> インターネットの進化：　そのなかで目指した物は&hellip;</p>

<ul>
<li>時間空間からの自由</li>
<li>メディアからの自由</li>
<li>リスクからの自由</li>
<li>現実の物からの自由</li>
<li>物理的容量からの自由</li>
</ul>


<p> これを街の単位で考えると<br/>
 「街」の抽象化：</p>

<ul>
<li>IOTによりセンシングした情報で街の状態をサイバー空間内で抽象化し処理を施し実空間に反映（アクチュエーティング）する</li>
</ul>


<p> インターネットで目指したことを「街」を対象にやってみる。</p>

<ul>
<li>コンテキストキャプチャー: 現状をいかにサンプリングするか</li>
<li>Visualizing context: コンテキストをビジュアルか（見える化）</li>
<li>optimal control: contextをもとに最適制御</li>
<li>prediction: 状態の予測</li>
</ul>


<p> <strong>ClouT = cloud of things:</strong></p>

<p> ClouTプロジェクトのコンセプトは，クラウドコンピューティングを活用することにより，「モノのインターネット」と「人のインターネット」を「サービスのインターネット」を通してつなぐこと。</p>

<p> 　　->  街の仮想化のベースとなる場所</p>

<p> <strong>言葉：</strong></p>

<ul>
<li><p>core heavy , Edge heavy :<br/>
  処理をコア（クラウド側）でやるのか、エッジ（デバイス側）でやるのかということ</p></li>
<li><p>センシングクラウド :<br/>
処理して必要な物だけをCloudにしまう（でも、それが要らない物、と言う判断はどうやってするのか）</p></li>
<li><p>IOTカーネル :<br/>
カーネルという考え方　　物理情報のオブジェクト化、抽象化</p></li>
<li><p>ソフトセンサ :<br/>
実際のIOTから得られた情報で二次的な情報を作り出す、あるいはwebなどの情報から状態をセンスする。
ソーシャルセンシングに近い？</p></li>
</ul>


<p> <strong>感想：</strong><br/>
 街というハードウエアをプログラミング対象として考えるとこうなる、のだろうが、すごいこと考えるなあ、というのが感想。ただ、線形のシステムではないので、一朝一夕に制御できるとは思えないけれど、今のソフトウエア技術を持ってすればいずれ最適制御は可能なんだろうなあ。<br/>
 インターネットの目的を聞いた時には、かなりセンセーショナルでした。そうなのかあ。と。　たしかにそうですよね。ここまで一般化できると、IoTへの視点も変わってきます。<br/>
 人とIoTを街という視点から見ると、街とインタラクションしながら動いているという意味では、同じものとみなせますね。人はアクチュエートできない、という点で違うけれど、手法を変えればある程度「制御」はできる。逆にものは完全に制御可能だけれど、「街」という複雑系の中に入った場合、果たして制御可能と言えるように振る舞えるのか？<br/>
 なんてことが頭をよぎりました。</p></li>
<li><p>　11:15〜12:00　　<strong>総解説・IoTを支える技術</strong>　　竹之下 航洋 氏　株式会社アットマークテクノ</p>

<p> IoTのリファレンスモデルの提唱：システムを考えやすくするためのリファレンスモデル</p>

<p> Layer 1．　<strong>フィジカルデバイス</strong>:<br/>
 　デバイスとコントローラ、センサ、アクチュエータなど　データを送り、コマンドを受け付ける</p>

<p> Layer 2．　<strong>コネクティビティ</strong>:<br/>
 　デバイスをネットワークに繋ぐ</p>

<p> Layer 3.　<strong>Edgeコンピューティング（fogコンピューティング）</strong>:<br/>
 　エッジ側での計算　　評価、フォーマット変換、必要なデータの抽出、判断<br/>
 　トラフィック、クラウドストレージデータの削減　コスト削減</p>

<p> Layer 4.　<strong>データアキュムレーション、ストレージ　（ここからはIT系の仕事）</strong>:<br/>
 　databaseの最適化　例えば google big query, Hadoop<br/>
 　大型ストレージ　例えば　amazonS3　GoogleDrive<br/>
 　IoTからのデータはイベントドリブンなので、とりあえず保管、という工程が必要になる。</p>

<p> Layer 5.　<strong>Data Aggregation、アブストラクション</strong>:<br/>
 　データベース同士の接続のためのレイヤ<br/>
 　データベースの抽象化、相互接続によるアプリケーションインターフェイスの容易化</p>

<p> Layer 6.　<strong>アプリケーション</strong>:<br/>
 　IoTのデータに基づく</p>

<ul>
<li>レポーティング</li>
<li>解析</li>
<li>コントロール</li>
</ul>


<p> 　ビッグデータで出来ることは</p>

<ul>
<li>過去の解析</li>
<li>異常検出</li>
</ul>


<p> 　多くのデータを処理できることで、見えていなかった何かが見える、あるいはデータ更新頻度を上げることで何か見落としていた物がみえるかも。<br/>
 　予測には　Google Prediction APIなど　モデリングよりも多くのデータから類推する方が速い。<br/>
 　最適化　データトレンドから予測し、最適なリソース配置を。</p>

<p> Layer 7.　<strong>コラボレーティング　プロセス</strong>:<br/>
 　他の系とのリレーション
 　問題は、「ビッグデータを元に何を動かすのか、何にフィードバックするのか」</p>

<p> <strong>まとめ</strong>：<br/>
 物作り企業にできることはレイヤの１〜３ぐらいだが、その他のレイヤのことも考えておく必要がある。<br/>
 セキュリティは重要課題。</p>

<p> <strong>キーテクノロジ</strong><br/>
 &ndash; edge側でのネットワーク</p>

<ul>
<li>SmartMESH　タイマー同期によるスリープ解除、ローパワー高信頼性</li>
<li>Wi-SUN     920MHzスター型　長距離転送</li>
<li>EnOcean     928MHz　省エネルギー、自分で発電など</li>
</ul>


<p> &ndash; プロトコル</p>

<ul>
<li>HTTP</li>
<li>MQTT</li>
<li>Fluentd     ソフトウエア実装　OSのログを取る仕組みと似ている</li>
</ul>


<p> &ndash; セキュリティの問題:<br/>
 　根本的解決には結局はVPNしかない（どうかなあ？？　プロモーション的にはそうだろうけど）</p>

<p> <strong>感想：</strong><br/>
 fluentdはフォーマットとしてJSON（JavaScript Object Notation）を使っている。データベースでフォーマットの解析が容易。そのままデータを入れればDBで解析できる。<br/>
 MQTTなどはプロトコルだけの規定なので、データそのものについてフォーマットの指定は無い。</p>

<p> リファレンスモデルはいいですね。素人の私でもわかりやすいです。<br/>
 プレゼンタはセキュリティの問題をポイントにして、自社製品への誘導を試みていますが、私のようなソロテクニシャンからするとそういうコストのかかることはできない。ベストエフォートというか、現状のコスト配分を最適にしてセキュリティリスクをできるだけ回避するようにしかできないのですよ。現状での手段はIPsecとSSH、暗号化してデータを送るとか。<br/>
 クラッキングがソーシャルを利用するように、セキュリティ強化のためにソーシャルなものを利用できないでしょうかね？それが一番強力なような気がする。<br/>
 データのプレディクションにはモデルを使わない、というのはけっこうショック。古い人間なので「モデリング」は重要とおもっていたけど。変なモデルを作るよりは、今までの1万倍のデータを持って来たほうが正確にプレディクションができる、というのは理にかなっているとおもったり、素人ながら。さらに、それをgoogleがすでに提供しているというのは初めて知った。</p></li>
<li><p>　13:30〜14:30　　<strong>【IoT基調講演】IoTの活用でビジネスイノベーションを加速しよう</strong>　　　稲田 修一 氏　東京大学</p>

<p> <strong>ビジネスの付加価値をどうやってIoTで高めるか</strong></p>

<p> 例：　アグリカルチャ　オランダの例<br/>
 単なる生産性の向上では無く、マーケットオリエントな生産をIoTで可能にする</p>

<p> &ndash; コンピュータを単なるデータ解析だけでなく、判断、理解に応用する流れ<br/>
 &ndash; そのためのinputとしてIoT　物理世界の情報をサイバー世界に持ち込むためのインターフェイスという位置づけ<br/>
 &ndash; それによって　認識・判断　が可能に</p>

<p> 例：　消費者の理解、生産工程の理解<br/>
 今まで部分的だった情報を統合できる可能性　これによって総合的な理解</p>

<ul>
<li>industrie 4.0　と　CPS (Cyber-Phisical system)</li>
</ul>


<p> <strong>スマート化の本質：</strong></p>

<ul>
<li>データ活用をどこに適用するか　「バリューチェーン」の明確化と最適な情報フィードバック</li>
<li><p>生産性・生産品質は当たり前の物になるだろう。</p></li>
<li><p><strong>品質が当たり前になればその他のところで製品の評価が決まる。（デザイン？）</strong></p>

<p> -> これにより「プロダクト」のパラダイムシフトが起こるであろう</p></li>
</ul>
</li>
<li><p>　14:45〜15:30　　<strong>IoTを夢で終わらせないために必要な事は何か</strong>　　　桑原 一悦 氏　日本電気株式会社</p>

<ul>
<li>IoTに必要なことは　アーキテクチャの理解</li>
<li><p>IoTを活用しようとしている場所の「アーキテクチャ」を理解することでデータ活用の仕組みを効率的に作ることが出来る<br/>
(これは、ソフトウエアの構造化のところでやったデータ構造＋アルゴリズム＝プログラムというのの逆の話？)</p></li>
<li><p>ステークホルダの相関関係を明確に</p></li>
<li>情報の入出力、解析、コスト、処理、使いやすさのバランスを考えた「機能配置」</li>
</ul>


<p> <strong>感想</strong><br/>
 IoTを使ったシステムのアーキテクチャを理解せよ、という話。全体を見ないと最適制御、最適配置、最適利益配分はできないということですね。時に組み込み技術者は全体を見ることを忘れてしまいますので、このことばに自戒をこめて。</p></li>
</ol>


<h2>2014/11/21</h2>

<ol>
<li><p>　10:00〜11:00　　<strong>【IoT基調講演】IoTにより変わる世界</strong>　　　内海 弦 氏　アーム株式会社</p>

<p> IoTは物作りを変える可能性がある。<br/>
 今までの流れ：　電子化からソフト化へ　　　例：そろばん−＞計算機械−＞電卓−＞アプリ <br/>
 全てはソフト化へむかっている。 実世界が抽象化によってソフトで表現できる。</p>

<p> IoTのポイント：</p>

<ul>
<li>情報のオープン化</li>
<li>他のビジネスのネタになるような情報の生成</li>
<li>抽象化</li>
<li>標準化</li>
<li>水平分業・協業</li>
</ul>


<p> mbedの話</p>

<p> mbedも抽象化、標準化を推し進めてより使いやすい物にしていく。そのためにデバイスをプラットフォーム化、オープンソース化する。<br/>
 共通OSの提供により、パワーコントロール、セキュリティ、デバイスドライブの隠蔽、抽象化。<br/>
 OSはイベントドリブンなもので、RTOSではない。　ライトウエイトでよりIoT向けの物に。来年リリース<br/>
 さらにIoTが繋がる先のクラウドも提供。</p>

<p> 感想：<br/>
 さすがにARMのプレゼンだけあって満席に近かった。現状mbedはOSが無い状況なので、「公式OS」が発表されればより一層アプリケーションが広がる可能性がある感じがする。私も乗り遅れないように今から勉強を始めようと思います。<br/>
 「抽象化」で、フィジカルなすべてがサイバーに投射される、という感覚は、internetが一般化した時にいろんな情報がnet上で再公開され利便性が増したことを想起させます。今度は、フィジカルな「もの」がそれにつながるわけで、これで本当のサイバーが出来上がるという感じがします。セキュリティなど考慮するべきことは多々あると思いますが。</p></li>
<li><p>　11:15〜12:00　　<strong>IoT市場動向と活用事例</strong>　　　江川 将峰 氏　ディジインターナショナル株式会社</p>

<p> zigbeeを中心としたワイヤレスデバイスの紹介。恥ずかしながらこの会社のことを知りませんでした。業界では有名なのでしょうね。<br/>
 ワイヤレスを使う予定はあまりなかったのですが、このプレゼンで指摘されたように「リソースリッチでない環境」ではバッテリ動作の小型・省電力無線デバイスとハブとなるプロセッサは必要かなあ、とも思い直しています。調べてみると、意外と簡単に使えそうなので試してみるものリストに入れておきます。</p></li>
<li><p>　12:30〜13:30　　<strong>組込み機器から始まるInternet of Your Things</strong>　　　澤 円 氏　日本マイクロソフト株式会社</p>

<p> 招待講演ですが、まあ、Microsoftですからね。内容はまあしれています。デモンストレートを中心とした現実離れしたIoTデバイスの開発事例でした。こちらはプロなので、「小学生でもできますよ」的なプレゼンテーションは全く意味がない。<br/>
 ただ、MSがIoTに対して（というかクラウド用サービス）に結構本気だというのはわかった。サブミリオンとかミリオンオーダーのデバイスをさばくような大メーカさん向けのサービスかな、という感じです。
 私は、IoTは大手メーカだけのものではなく、小さなメーカ(makers?)が製品付加価値を大きくするための強力なツールだと思うので、年産数台のものを何十種類も作っているような中小メーカのためにこそ活用されるべきで、そこがメインターゲットだと思っています。</p></li>
<li><p>　13:30〜14:30　　<strong>古くて新しいシステム開発のアプローチ システム エンジニアリングが導く、日本のものづくりの新ステージ</strong>　　　（パネルディスカッション）</p>

<p> システムズエンジニアリングは直接IoTとは関係無いですが、IoTを活用するシステム全体を考慮するとこういう視点まで引いて考える必要があるかなと思います。ここはまとまってメモできなかったので、キーワード的に箇条書きでまとめておきます。</p>

<ul>
<li>団塊世代の技術者の「おれってすごい」的発言で場がしらける。</li>
<li>NASDAの技術者の話がなかなか説得力があり、おもしろい。</li>
<li>ポイントは：行き着く先に何があるのか、意識することが大切</li>
<li>人間も「システムの一部」として、その要因を出来るだけ排除するのか、それとも最大限に考慮するのか</li>
<li>現実世界の抽象化</li>
<li>人材のマネージメント、技術・スキル・マインド・性格</li>
<li>ステークホルダとバリュー</li>
<li>システムを取り巻く環境もシステムの一部（インフラ、政策など）</li>
</ul>
</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[このwebでは...]]></title>
    <link href="http://mm011106.github.io/blog/2014/11/29/motivation/"/>
    <updated>2014-11-29T14:52:11+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/11/29/motivation</id>
    <content type="html"><![CDATA[<p>このwebは、IoTデバイスを開発する経過をメモするために設けました。</p>

<p>最初のアイディアは2012年の春頃のことです。データロガーのデータをユーザに向けて一定時間ごとに報告するようなシステムを作る必要に駆られて設計することになり、<!-- more -->まずはメールベースでデータを送信するようなハードウエアを、ArduinoとMac（！）でプロトタイピングしました。<br/>
このシステムは一応うまく動いて、半年の間、データを１時間ごとにクラウド（といっても事務所の中のlinuxサーバ）に向け「メール」し、その中でデータをまとめ、６時間毎にgnuplotで作成したPDFファイルのグラフをユーザ送ることが出来ました。</p>

<p>その後、2013年にRaspberryPIにエッジデバイス機能を実装して試していましたが、なんかちょっと腑に落ちない感じでした。<br/>
というのも、メールプロトコルというのがどうも気になっていたのです。ある程度セキュアでいいのですが、双方向にしようと思うと結構エッジ側の負担が重くなる。RaspberryPIぐらいの高機能デバイスならいいですが、mbedぐらいの軽いデバイスに載せ替えようとおもうと、ちょっと大変。将来的にバッテリ駆動+3G回線みたいな環境に適応させることを考えると、軽いデバイスで実装できるシステムを作っておいたほうがいい、そんな気持ちでした。<br/>
そんなところに、MQTTというプロトコルがあるということをつい最近（2014年夏頃）知って、それに飛びついたわけです。試したところ、RaspberryPIなら十分軽くてブローカ（MQTTのサーバのこと）にもできそうだし、最初のアイディアのシステムはMQTTに移行してRaspberryPI上で同様の機能が２つぐらいのスクリプトファイルだけで動作しています。さらにmbedにもプロトコルの実装例があるので、素人でも行けそうかなあと思いました。</p>

<p>このへんはこれからの作業になりますが、まずは、このデバイスのプロトタイピングでやった内容をブログにまとめておきたいと思います。<br/>
また、同様にこれからやることもまとめていきたいと思います。<br/>
将来自分が見て「ああ、こんなことやってたのね」と思えると同時に、同じようなことをやろうとしている人の助けになればと思います。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[手始めに、色々と試してみます]]></title>
    <link href="http://mm011106.github.io/blog/2014/11/29/first-step/"/>
    <updated>2014-11-29T14:52:11+09:00</updated>
    <id>http://mm011106.github.io/blog/2014/11/29/first-step</id>
    <content type="html"><![CDATA[<p>シェルコマンドの表示例です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">echo</span> <span class="k">${</span><span class="nv">test</span><span class="k">}</span>
</span><span class='line'>cat /var/log/syslog <span class="p">|</span> grep <span class="s1">&#39;test_log&#39;</span> &gt; temp.txt
</span></code></pre></td></tr></table></div></figure>


<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>rake watch
</span></code></pre></td></tr></table></div></figure>


<p>を別のコンソールから起動しておけば、ポスト用のテキストファイルを保存するたびにrake generateしてくれます。エラーも出るので構文がエラーしているとすぐフィードバックしてくれます。これは結構便利。</p>

<p>カテゴリは、カテゴリ名にスペースが入るとダメ（スペースで分けられて個別のカテゴリになってしまう）。スペースが入るときは[]で囲って、コンマで区切る。<br/>
日本語も大丈夫。</p>

<p>改行するときは行末に２文字の半角空白を置くと、<br/>
こんなふうに改行できます。</p>

<p>現在、octopressのディレクトリ内からソースファイルをエディットして、自動でgenerate、適当なところで手動でweb用のリポジトリ内にコピー、そこからcommit &amp; pushしています。<br/>
ちょっと効率が悪い、ソースがローカルに保存されてしまう、という欠点があるので何とかしたいと思います。<br/>
世の中には rake setup_github_pages というものがあるらしいが、詳しく調べてみる。<br/>
やはり大元の<a href="http://octopress.org/docs/deploying/github/">ここ</a>が詳しいか？</p>

<h2>写真</h2>

<p>本題に入る前に、区切り線の挿入。
区切り線の前の行は文字が大きくなり、タイトルっぽくなります。</p>

<p>大切な写真の埋め込み例をやります。  まずは、markdownの標準のやりかた</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>!<span class="o">[</span>これは写真です<span class="o">](</span>/images/hana.jpg <span class="s2">&quot;HANA!&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://mm011106.github.io/images/hana.jpg" title="HANA!" alt="これは写真です" />
写真の次のテキストはこんな位置に来ます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>!<span class="o">[</span>これは小さい写真です<span class="o">](</span>/images/hana_small.jpg <span class="s2">&quot;Shrinked HANA!&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://mm011106.github.io/images/hana_small.jpg" title="Shrinked HANA!" alt="これは小さい写真です" /></p>

<p>改行を１行入れたあとの、写真の次のテキストはこんな位置に来ます。<br/>
次に、octopressでのタグフォーマットです。
フォーマットはこんな形になります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">{</span>% img <span class="o">[</span>class names<span class="o">]</span> /path/to/image <span class="o">[</span>width<span class="o">]</span> <span class="o">[</span>height<span class="o">]</span> <span class="o">[</span>title text <span class="o">[</span>alt text<span class="o">]]</span> %<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>class name の選択肢がわかりませんが、とりあえず例を参考にすると。。。。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">{</span>% img /images/hana.jpg <span class="s1">&#39;HANA!&#39;</span> %<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://mm011106.github.io/images/hana.jpg" title="'HANA!'" ></p>

<p>このフォーマットだと左右に寄せることができ、サイズも指定できます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">{</span>% img center /images/hana.jpg <span class="m">400</span> <span class="s1">&#39;center 400 HANA!&#39;</span> %<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img class="center" src="http://mm011106.github.io/images/hana.jpg" width="400" title="'center 400 HANA!'" ></p>

<p>すぐ次の行に文字を入れるとこんなかんじです。<br/>
多分写真の下に文字が来ると思いますが。。。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">{</span>% img left /images/hana.jpg <span class="m">300</span> <span class="s1">&#39;300 HANA!&#39;</span> %<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://mm011106.github.io/images/hana.jpg" width="300" title="'300 HANA!'" ></p>

<p>写真の埋め込みコマンドの次の行です。ここに文章を入れないとすこしフォーマットがおかしくなる感じですね<br/>
写真の縦の高さ分、文字がないと、次の写真を今の写真の右側に流し込もうとして変な感じになります。</p>

<p>それは、それで正しいフォーマッティングかと思います。<br/>
この行数では、safari上で行数が足りません。firefoxよりも文字が小さく表示されるようです。</p>

<h2>この状態で「区切り」を入れてみます。</h2>

<p>やっぱりうまく行きませんね。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">{</span>% img right /images/hana_small.jpg <span class="s1">&#39;Shrinked HANA!&#39;</span>　<span class="s1">&#39;ハナさん&#39;</span> %<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img class="right" src="http://mm011106.github.io/images/hana_small.jpg" title="Shrinked HANA!" alt="ハナさん"></p>

<p>ここにも少し文章が必要です。<br/>
ブログページの最後が写真で左右寄せに指定するときには、最後のところに少し文章が必要ですね。次のページのスタートが崩れます。<br/>
  　　<br/>
　　<br/>
　　<br/>
　　　　</p>

<p>右寄せの写真、左寄せの写真を続けて挿入すると。。。。</p>

<p><img class="left" src="http://mm011106.github.io/images/hana.jpg" width="200" title="'left HANA!'" >
<img class="right" src="http://mm011106.github.io/images/hana.jpg" width="200" title="'right HANA!'" ></p>

<p>そして、この文章は写真の次の行です。<br/>
写真と写真の間に流し込まれているかしら？</p>

<p>　　</p>

<p>　　</p>

<p>　　
　　</p>
]]></content>
  </entry>
  
</feed>
